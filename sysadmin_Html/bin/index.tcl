#!/bin/sh
#\
exec tclsh "$0" ${1+"$@"}

# 3 juillet 2003 (FP) création
# 2005-01-27 (FP) modifs
# 2008-09-16 (FP) soda -> bob

package require tdom 0.7.7
package require fidev
package require fidev_xh 0.1                
  
if {[info hostname] != "bob.lpn.prive"} {
    puts stderr "Doit être exécuté sur bob.lpn.prive et non sur [info hostname]."
    exit 1
}

set BASE  /export/www/html/p10admin/

package require fidev
package require fichUtils 0.2

set SCRIPT [file join [pwd] [info script]]
while {[file type $SCRIPT] == "link"} {
    set SCRIPT [file readlink $SCRIPT]
}


set html [xh::new]
xh::C $html "== automatically generated by [::fidev::fichUtils::followLinks $SCRIPT] =="
set head [xh::E $html head]
set body [xh::E $html body {class body-sheet}]
xh::E $head meta {http-equiv "content-type" content "text/html; charset=ISO-8859-1"}
xh::E $head link {type text/css href /css/phydis_styles.css rel stylesheet}
xh::ET $head title {} "Groupe de Physique des dispositifs (Intranet)"

xh::E $body br

############ ##### deux colonnes ###


set btsb [xh::Es $body {
    table {border 0 cellspacing 0 class table-sheet-border cellpadding 1 width 95% align center summary "table-sheet-border"}
    tbody {}
    tr {}
    td {rowspan 1 colspan 1}
}]
set 2cols [xh::E $btsb table {border 0 cellspacing 0 cellpadding 2 width 100% summary "deux colonnes"}]

set tr0 [xh::E $2cols tr]
set tdlogo [xh::E $tr0 td {rowspan 2 align left valign top class td-fond-logo}]
set tdtitre [xh::E $tr0 td {class td-fond-logo}]
set trchoix [xh::E $2cols tr]
set tdchoix [xh::E $trchoix td {class td-nav-bar height 21}]

xh::ET [xh::E $tdtitre center] b {} "Groupe de Physique des Dispositifs"

set a [xh::E $tdlogo a {href http://www.lpn.cnrs.fr}]
xh::E $a img [list src /i/logo_lpn57transp.gif alt "Logo du CNRS" border no]    

set mainlink a-nav-bar
set highlight a-nav-bar-current

xh::T $tdchoix "\u00a0"
xh::ET $tdchoix a [list href http://www.cnrs.fr class $mainlink] CNRS
xh::ET $tdchoix span {class divider} "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://www.lpn.cnrs.fr class $mainlink] LPN
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href https://webmail.lpn.cnrs.fr class $mainlink] Webmail
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://www.lpn.prive/intranet/ class $mainlink] "old Intranet"
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://www.lpn.prive/spip/ class $mainlink] Intranet
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://bob.lpn.prive class $highlight] Phydis
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://satiric.lpn.prive/wiki/ class $mainlink] Wiki
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href /cgi-bin/fom class $mainlink] "Faq-O-Matic"
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://www.google.com class $mainlink] Google 
xh::ET $tdchoix span {class divider}  "\u00a0\u00a0|\u00a0\u00a0"
xh::ET $tdchoix a [list href http://www.exalead.fr class $mainlink] Exalead 

set tr [xh::E $2cols tr]
set tdg [xh::E $tr td {valign top class td-sheet}]
set tdd [xh::E $tr td {valign top width 100% class td-sheet}]
unset tr 2cols

set table [xh::E $tdg table {border 0 cellspacing 0 cellpadding 0 width "91" summary "colonne de gauche"}]

xh::ET [xh::E $table tr] td] {} "\u00a0"
xh::ET [xh::E [xh::E $table tr] td {class uslnavplain}] b {} "Liens"
proc newbase {} {return "http://satiric.lpn.prive/wiki/index.php/Cat%C3%A9gorie:"}
foreach {k v} [subst {
    {} {}
    trombinoscope /Lpn/dynamic/trombines_lpn-admin.html
    administratif [newbase]Administration
    "vie sociale" [newbase]Vie_sociale
    {} {}
    informatique [newbase]Informatique
    {} {}
    revues [newbase]Revues
    {} {}
    "salle blanche" [newbase]Salle_blanche
    {} {}
    "animations phydis" [newbase]Animations_phydis
}] {
    set td [xh::E [xh::E $table tr] td] 
    if {$k != {}} {
	xh::ET $td a [list class uslnav href $v] $k
    } else {
	xh::T $td "\u00a0"
    }
}

set tcentre [xh::Es $tdd {
    table {border 0 cellspacing 0 align center summary "main" width 100%} 
    tbody {}
    tr {}
    td {rowspan 1 colspan 1 align center valign middle}
}]

xh::E $tcentre img [list src /techno/i/MHBT1.jpg alt "TBH"]

set ts [xh::Es $body {
    table {border 0 cellspacing 0 align center summary "création" width 95%}
    tbody {}
    tr {}
    td {rowspan 1 colspan 1 class address-page-signature}
}]

set instant [clock seconds]
xh::E $ts br
xh::T $ts "Créé le [clock format $instant -format %Y.%m.%d] à [clock format $instant -format %H:%M:%S] par"
xh::ET [xh::E $ts ul {}] li {class file-list} "[info hostname]:$SCRIPT"

set fifi [file join $BASE index.html]
xh::toFile $html $fifi
unset html
#    puts stderr \n$fifi
xh::tidy $fifi
